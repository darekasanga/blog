<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EMPEROR.NEWS | AI COVE解析</title>
  <link rel="stylesheet" href="../assets/styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="inner">
      <div class="brand">
        <div class="brand-mark" aria-hidden="true"></div>
        <div>
          <p class="brand-kicker">BLOG</p>
          <p class="brand-title" data-site-title>EMPEROR.NEWS</p>
        </div>
      </div>
      <div class="header-actions">
        <nav class="nav-links" aria-label="メインナビゲーション">
          <a href="../index.html" class="nav-link">トップ</a>
          <a href="../admin/login.html?redirect=/analyze/index.html" class="nav-link" data-auth="guest">ログイン</a>
          <a href="../admin/index.html" class="nav-link" data-auth="auth" hidden>記事投稿</a>
          <a href="../admin/edit.html" class="nav-link" data-auth="auth" hidden>記事編集</a>
          <a href="index.html" class="nav-link active" data-auth="auth" hidden>AI COVE解析</a>
          <button class="nav-link nav-button" type="button" data-auth="auth" data-action="logout" hidden>ログアウト</button>
        </nav>
      </div>
    </div>
  </header>

  <main>
    <section class="section">
      <div class="inner">
        <div class="section-header">
          <div>
            <p class="kicker">AI COVE</p>
            <h1>AI COVE解析</h1>
          </div>
        </div>
        <p class="lead">MFA認証後に、解析対象の記事と補正ポイントを記録できます。</p>
        <div class="analysis-mode">
          <p class="kicker">解析モード</p>
          <div class="preview-mode-picker" role="group" aria-label="解析プレビューのモード">
            <button class="mode-button is-active" type="button" data-analysis-mode="frame" aria-pressed="true">
              <span class="mode-icon mode-icon-frame" aria-hidden="true"></span>
              <span>文字枠指定</span>
            </button>
            <button class="mode-button" type="button" data-analysis-mode="pen" aria-pressed="false">
              <span class="mode-icon mode-icon-pen" aria-hidden="true"></span>
              <span>赤ペン</span>
            </button>
          </div>
        </div>
        <div class="analysis-handwriting" aria-live="polite">
          <p class="kicker">手書きモード</p>
          <p class="muted-text" id="handwriting-status" data-handwriting="active">両枠とも手書き入力中</p>
        </div>

        <div class="analysis-editor">
          <section class="analysis-panel handwriting-panel" data-panel-role="handwriting" aria-labelledby="analysis-source-title">
            <div>
              <p class="kicker">Handwriting</p>
              <h2 id="analysis-source-title">手書き文字</h2>
              <p class="muted-text">左側は手書き入力専用です。ペンで自由に書き込んでください。</p>
            </div>
            <canvas id="handwriting-left" class="handwriting-canvas" aria-label="左側の手書きキャンバス"></canvas>
            <div class="handwriting-actions">
              <button class="btn muted" type="button" data-action="clear-left">クリア</button>
            </div>
          </section>

          <section class="analysis-panel correction-panel" data-panel-role="analysis" aria-labelledby="analysis-correction-title">
            <div>
              <p class="kicker">Analysis</p>
              <h2 id="analysis-correction-title">解析メモ</h2>
              <p class="muted-text">右側で文字認識を行い、1文字ずつ枠指定して確定します。</p>
            </div>
            <div class="layered-output">
              <div class="layered-output__stack" id="handwriting-stack">
                <canvas id="analysis-layer" aria-label="右側の手書きキャンバス"></canvas>
                <canvas id="correction-layer" aria-label="枠指定キャンバス"></canvas>
                <div class="layered-output__characters" id="character-layer" aria-live="polite"></div>
                <div class="layered-output__placeholder" id="handwriting-placeholder">
                  手書き入力後、枠指定モードで1文字ずつ囲ってください。
                </div>
              </div>
              <div class="layered-output__meta">
                <p class="muted-text">枠指定で1文字ずつ囲むとOCR候補が表示されます。正しければタップして確定してください。</p>
                <div class="layered-output__actions">
                  <button class="btn muted" type="button" data-action="clear-right">クリア</button>
                  <button class="btn muted" type="button" data-action="clear-frames">枠をリセット</button>
                  <button class="btn" type="button" data-action="finalize-training">最終確定</button>
                </div>
                <p class="decoded-text" id="recognized-text">OCR候補: -</p>
                <p class="decode-status" id="training-status"></p>
              </div>
            </div>
          </section>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="inner footer-grid">
      <div>
        <p class="brand-title" data-site-title>EMPEROR.NEWS</p>
        <p class="muted-text" data-footer-description>シンプルで統一感のあるブログ体験を届けます。</p>
      </div>
      <div id="site-theme-picker" class="footer-theme-picker" aria-label="表示テーマ選択"></div>
    </div>
  </footer>

  <script src="../assets/header-auth.js"></script>
  <script src="../assets/analyze.js"></script>
</body>
</html>
